<analysis>
The AI engineer's work spanned critical bug fixes, feature enhancements, and UI/UX improvements for a maritime document management application. Key tasks included resolving a persistent 404 error for new base fee endpoints by relocating them in , refining the Total Ships calculation in  to only count ships with associated certificates (involving fixing API endpoint calls and making  optional for ), and streamlining Crew Members calculation by removing redundant frontend filtering. UI/UX changes involved removing icons and colored boxes from company statistics, implementing a monthly fee calculation feature, and restructuring the  with a new layout, language toggle, and integrating Introduction, Road Map, and User Guide modals. Throughout, user role hierarchy was refined, elevating  and equating  permissions. The current task is to refine the User Guide's Fee Calculation section, specifically by removing tips and dynamically inserting the system's base fee.
</analysis>

<product_requirements>
The application is a comprehensive system for managing maritime documents for ships and crew, with a strong focus on AI-driven data extraction and automation. Key existing modules include Crew List, Approval Document, and Other Audit Documents.

Recent feature and fix requests from the user:
1.  **Enhanced AI Extraction for New Ship**: Improve autofill for Last Docking 1, Last Docking 2, and Ship Type during new ship creation from documents, supporting flexible date formats and dropdown for ship types (modifying ).
2.  **Add System Admin Role**: Introduce a new, highest-privilege user role.
3.  **Rename Departments**: Update Vietnamese labels for Operations to Khai th√°c and Commercial to Kinh Doanh.
4.  **Department Auto-selection/Locking**: For Crew or Ship Officer roles, auto-select and lock Ship Crew department.
5.  **Add SSO and CSO Departments**: Introduce SSO and CSO departments with specific visibility rules.
6.  **Filter Departments by Role**: Implement role-based filtering for department options.
7.  **Company Detail Modal**: Display company info, total ships (later refined to only count ships with certificates), and total non-crew/crew users.
8.  **Edit Base Fee Feature**: Add Edit Base Fee button and modal in Company Management, with backend endpoints for update and retrieval.
9.  **Total Ships Counting Logic**: In Company Details, count only ships with at least one Ship Certificate or Audit Certificate.
10. **Crew Members Calculation Logic**: Simplify by removing redundant frontend filtering as backend already filters by company.
11. **UI Refinement - Company Details**: Remove icons and colored boxes from statistics.
12. **Monthly Fee Calculation**: Add a T√≠nh Ph√≠ button to Company Details, calculate , and display it.
13. **Company Management Filtering**: Users should only see their own company (unless System Admin/Super Admin).
14. **Role Hierarchy Update**: System Admin is the highest role, above Super Admin. Later, Super Admin permissions were made identical to System Admin.
15. **AI Configuration Visibility**: Only accessible to Super Admin and above.
16. **Login Page Redesign**: Move login modal right, add placeholder buttons (Introduction, Road Map, User Guide, Contact) on the left, and a language toggle.
17. **Content Modals**: Create Introduction, Road Map, and User Guide modals with specific content and styling, integrated into the Login Page.
18. **User Guide T√≠nh Ph√≠ Section**: Add details on fee calculation, including dynamic base fee.
</product_requirements>

<key_technical_concepts>
-   **Frontend**: React.js (functional components, hooks, modals), Axios for API calls, Tailwind CSS for styling,  context for user management.
-   **Backend**: FastAPI (API, Pydantic models, Dependency Injection for authentication), MongoDB for data storage (UUIDs, sparse unique indexes).
-   **External**: Google Drive integration (via Google Apps Script, partial), LLM for OCR/document analysis.
-   **Patterns**: RESTful API design, modular frontend architecture, role-based access control.
</key_technical_concepts>

<code_architecture>
The application comprises a React.js frontend and a FastAPI/MongoDB backend.



-   ****:
    -   **Importance**: Main FastAPI application logic, API routes, data models, and utility functions.
    -   **Changes**:
        -   **Base Fee Endpoints**:  and  were *moved* from after  to a correct location after  endpoints (around line 5290) to resolve 404 errors.  endpoint explicitly uses  for .
        -   **Audit Certificate Endpoint**:  () was modified to make  to allow fetching all audit certificates if  is not provided.
        -   **User Roles & Departments**:  model and related logic reviewed to confirm  field presence.
-   ****:
    -   **Importance**: Displays company details and statistics.
    -   **Changes**:
        -   **Total Ships**: Logic modified to fetch  and  (after  made optional) and count only ships associated with at least one certificate.
        -   **Crew Members**: Simplified logic to use  directly, removing redundant frontend filtering after backend was confirmed to filter by .
        -   **UI**: Removed all emoji icons and colored background boxes from statistics cards.
        -   **Monthly Fee**: Added  function,  state, a T√≠nh Ph√≠ button, and display of the calculated fee next to the company name.
        -   **Debugging**: Temporary  statements added for debugging statistics issues.
-   ****:
    -   **Importance**: Manages company-related actions and views.
    -   **Changes**:
        -   **Company Filtering**:  modified to filter companies by  unless the user is  or .
        -   **Permissions**: , ,  logic updated to align with  as the highest role (and  having equal permissions).
-   ****:
    -   **Importance**: Handles adding new users.
    -   **Changes**: Updated role hierarchy logic to reflect  as the highest, with  permissions adjusted accordingly.
-   ****:
    -   **Importance**: Handles editing existing users.
    -   **Changes**: Updated role hierarchy logic similarly to .
-   ****:
    -   **Importance**: Main System Settings page displaying various configuration sections.
    -   **Changes**:
        -   **AI Configuration Visibility**: Modified to display only for  or  roles.
        -   **Section Permissions**: Other sections (User Management, Company Management, Admin Tools) updated to ensure  (and ) have full access.
-   ****:
    -   **Importance**: User login interface.
    -   **Changes**:
        -   **Layout Redesign**: Moved login modal to the right, added a left panel with placeholder buttons for Introduction, Road Map, User Guide, and Contact.
        -   **Language Toggle**: Added a language switch (English/Vietnamese) to the top right.
        -   **Modal Integration**: Integrated , , and  components, and enabled their respective buttons.
-   ** (NEW)**:
    -   **Importance**: Displays a detailed introduction to the system's features, especially AI capabilities, in English and Vietnamese.
    -   **Changes**: Created from scratch with user-provided content and styling.
-   ** (NEW)**:
    -   **Importance**: Displays the project's roadmap with key milestones.
    -   **Changes**: Created from scratch with user-provided content and professional styling, including a specific light blue background for sections.
-   ** (NEW)**:
    -   **Importance**: Provides instructions on basic system operations.
    -   **Changes**: Created from scratch with user-provided content. Later, a T√≠nh Ph√≠ (Fee Calculation) section was added, including the formula and notes. Styles updated for consistent light blue color.
</code_architecture>

<pending_tasks>
-   Full testing of Sync from Drive functionality UI.
-   Bulk export/download for certificates via context menu.
-   Certificate File Viewer.
-   Scalability improvements.
-   Toast notifications for Deleting files on Drive for  and .
-   Verify background file deletion for crew records.
-   Comprehensive testing of the newly migrated  module (Phase 11).
-   Address AI configuration for , resolve lookup discrepancies, and set up a default AI config.
-   Resolve persistent Tesseract/Poppler installation issues to enable full OCR functionality.
-   Confirm with the user if the Issued By abbreviation logic is now working as expected.
-   Test the implemented backend background task for file movement in various scenarios (for Crew Records).
-   Implement the gradual backend refactoring according to sidebar categories using the Strangler Fig Pattern.
-   Simplify the Add New Ship process to create only a single folder per ship name in the company's root Google Drive.
-   Update other frontend pages (besides ) to handle the .
-   Refine the T√≠nh Ph√≠ (Fee Calculation) section in  by removing üí° Tips and dynamically fetching the current  for the example.
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was working on enhancing the user experience on the  and .

The work involved:
1.  **Login Page Redesign**: The login modal was moved to the right, and a left panel was introduced with placeholder buttons for Introduction, Road Map, User Guide, and Contact. A language toggle (English/Vietnamese) was also added to the top right of the page.
2.  **Introduction, Road Map, and User Guide Modals**: New React components (, , ) were created to display static information as requested by the user, and integrated into the  via their respective buttons. The styling of these modals was updated to use a consistent light blue color for sections.
3.  **Company Detail Enhancements**:
    *   **Monthly Fee Calculation**: A new T√≠nh Ph√≠ (Calculate Fee) button was added to the . Clicking this button triggers a calculation using the formula: , and the result is displayed alongside the Company Name.
    *   **Role Hierarchy Consistency**: Permissions across the application (e.g., in , ) were adjusted to ensure  is the highest role, and  has identical permissions to .

The very last explicit request from the user (Message 384) was to:
1.  Remove the üí° Tips section from the T√≠nh Ph√≠ (Fee Calculation) description within the .
2.  Dynamically populate the  value used in the example calculation in the  with the currently configured system base fee.

The AI engineer has acknowledged this request and was about to implement it when this summary request was made.
</current_work>

<optional_next_step>
Implement the requested changes for the T√≠nh Ph√≠ section in .
</optional_next_step>
