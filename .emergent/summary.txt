<analysis>
The previous AI engineer systematically enhanced the Ship Management System. Initial efforts involved debugging a Company Google Drive not configured error, which revealed an Apps Script timeout, leading to increased timeouts and improved backend-Apps Script interaction. Concurrently, the engineer refined Marine Certificate classification, adding Conditional type, enhancing PMDS and maritime insurance detection, and enforcing strict categorization into six types. A significant focus was on multi-select UI/UX: fixing context menu behavior for Open and Copy Links (including pre-fetching for speed), and improving context menu positioning. The engineer also updated Cert. Name abbreviation logic, enforced Last Endorse rules for Full Term certificates, added Next Survey Type column, and restructured Detailed Ship Information with new fields and a 3-column layout. The work concluded with research into precise logic for Anniversary Date and Dry Dock Cycle.
</analysis>

<product_requirements>
The Ship Management System, using React, FastAPI, and MongoDB, aims to improve maritime document management. Key objectives included system stabilization (login/Pydantic fixes, preview URL access), enhancing AI analysis for PDF/image processing and OCR, and robust Google Drive integration (dynamic folders, file deletion). UI/UX improvements for the Certificate List were crucial: reordering columns, resizing/sorting, renaming categories, handling Valid Date display, and implementing multi-select with context menu actions (Open, Copy Link, Edit, Delete). Specifically, multi-file opening and copying links with pre-fetching were requested. AI classification was updated to include Conditional type, recognize PMDS and maritime insurance organizations, and restrict types to six predefined values. Business rules for Last Endorse (only for Full Term certificates) were implemented. Finally, Next Survey Type and enhanced ship details (Last Docking, Last Special Survey, Dry Dock Cycle, Anniversary Date) were added with a new 3-column layout.
</product_requirements>

<key_technical_concepts>
-   **FastAPI**: Backend REST API.
-   **React**: Frontend UI.
-   **MongoDB**: Data persistence.
-   **OCR (Tesseract, Google Vision API)**: Document text extraction.
-   **LLM Integration (Gemini)**: AI analysis.
-   **Google Drive API (via Apps Script)**: Document storage/management.
-   **Tailwind CSS**: Styling.
-   **Supervisor**: Process management.
-   **Pydantic**: Data validation.
-   ****: Client-side caching for links.
</key_technical_concepts>

<code_architecture>
The application uses a full-stack architecture: React frontend, FastAPI backend, MongoDB database.



-   ****:
    -   **Importance**: Core backend logic for API routes, data handling, and AI integration.
    -   **Changes**: Enhanced logging, retry logic, and increased Apps Script timeout (90s) for Google Drive operations. Updated AI prompt for certificate classification with Conditional type, PMDS, and maritime insurance rules. Implemented  and  functions, enforcing Last Endorse only for Full Term certificates. Added  to certificate models and AI prompt. Expanded  and  models with , , , . Modified  to remove Statement of Compliance. Implemented strict validation for 6 certificate types. Adjusted permissions for abbreviation mapping endpoints.
-   ****:
    -   **Importance**: Handles Google Drive interactions.
    -   **Changes**: Incorporates dynamic folder structure fetching from the backend and synchronized fallback logic. Its timeout is now implicitly managed by backend retry logic and increased timeout settings.
-   ****:
    -   **Importance**: Main React component managing UI, state, and API calls.
    -   **Changes**: Fixed context menu  action and right-click multi-selection behavior. Implemented  and  for multi-select, including dynamic text, selection indicators, and robust popup handling. Introduced per-ship link pre-fetching using  with visual indicators for loading/ready states. Added a Search input field for  and . Implemented conditional display for Last Endorse field/column (only for Full Term). Added Next Survey Type column and input field. Refactored Detailed Ship Information to a 3-column layout, showing new ship-related fields and hiding others. Improved Multi-Cert Upload progress bar to show current filename. Fixed context menu positioning to prevent overflow.
</code_architecture>

<pending_tasks>
-   **Refine Anniversary Date logic**: Research and implement logic to derive day/month from Class/Statutory Certificates for .
-   **Refine Dry Dock Cycle logic**: Research and implement  as a 5-year  and  range, including a single intermediate docking.
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was tasked with refining the logic for two newly introduced fields within the Detailed Ship Information:  and . The current implementation of these fields is basic, and the user requested more sophisticated, maritime-specific logic.

For , the user explicitly requested that it should only capture the day and month, typically derived from the expiry dates of Full Term Class and Statutory Certificates.

For , the user requested it be modeled as a 5-year period (represented by From and To fields), with the additional business rule that one intermediate docking inspection must occur within this 5-year cycle.

The engineer had just initiated the research phase to gather the necessary maritime domain knowledge to accurately implement these complex business rules, reflecting a shift from basic field addition to integrating industry-specific operational logic. A previous minor issue about new ship fields displaying '-' post-save might be addressed during this refinement.
</current_work>

<optional_next_step>
Research maritime standards for  and  to define the exact logic for deriving and displaying these values.
</optional_next_step>
