<analysis>
The trajectory details an intensive, iterative development cycle for a Ship Management System, driven by highly specific user feedback. The work began by addressing inconsistencies in the AI's data extraction from certificate PDFs. A major feature was implemented to handle AI extraction failures during multi-certificate uploads: instead of creating a flawed record, the system now pauses the upload for that specific file and prompts the user for manual input.

Subsequently, a significant effort was dedicated to building an Admin Tools section within the application's System Settings. This new section houses a manually triggered backfill process to re-analyze older certificates and populate missing ship information, a feature the user later requested to be simplified by removing automated scheduling and background queueing.

The latter half of the trajectory focuses heavily on UI/UX refinements. This includes extensive refactoring of the Manual Input and Edit Certificate forms to include all database fields, arranging them in a compact, multi-column layout. Dropdown options for Certificate Type and Survey Type were synchronized across all input methods (AI extraction, manual forms, and a new Quick Edit feature) based on precise user specifications, including specific Vietnamese translations. A Quick Edit context menu for the Survey Type field was implemented and rigorously debugged, resolving complex issues related to React component scope and conflicting  event handlers. The final task involved starting to synchronize the text of these dropdown options.
</analysis>

<product_requirements>
The application is an AI-powered Ship Management System for managing maritime certificates.

**Core Functionality:**
1.  **AI-Powered Certificate Processing:** The system uses AI to extract data from uploaded PDF/image certificates during a multi-file upload process.
2.  **AI Extraction Failure Handling:** If the AI fails to extract critical information (e.g., ship name, certificate name, number), the upload for that specific file must be paused. The UI's progress bar should display a message guiding the user to use the Add Certificate form for manual entry, and the Manual Input button should be removed.
3.  **Admin Tools:** The System Settings page must contain an Admin Tools section, visible only to Admin/Super Admin roles, which includes a button to manually trigger a backfill process for enriching older certificate records with AI-extracted data.
4.  **Form Parity:** The Edit Certificate modal and the Add Certificate (manual input) form must contain all fields stored in the database for a certificate. This includes fields like Abbreviation, Type, Issued By, Status, and Notes. The layouts must be compact and optimized to fit on a single screen without scrolling, using a multi-column grid.
5.  **Dropdown Synchronization:** The options within the Certificate Type and Survey Type dropdowns must be consistent across the Manual Input form, Edit Certificate form, and the Quick Edit context menu. The specific options and their Vietnamese translations are dictated by the user.
6.  **Quick Edit Feature:** Users must be able to right-click on the Survey Type cell within the main certificate table to open a custom context menu, allowing for immediate selection and updating of the survey type without opening the full edit modal.
</product_requirements>

<key_technical_concepts>
- **Full-stack Architecture**: React frontend ( as a single large component), FastAPI (Python) backend (), and MongoDB database.
- **AI/LLM Integration**: Google Gemini for OCR and structured data extraction from PDFs. The AI prompt in the backend is dynamically updated to refine extraction requirements.
- **Frontend State Management**: Extensive use of React hooks (, ) to manage UI state, including modals, context menus, and asynchronous data.
- **Event Handling**: Advanced JavaScript event handling, including , , and  to manage conflicting context menus and prevent event bubbling.
</key_technical_concepts>

<code_architecture>
The application follows a monorepo structure with a backend and frontend directory.



-   ****
    -   **Summary**: This file is the complete FastAPI backend. It handles all API endpoints, database interactions with MongoDB, Pydantic data models, and the core business logic, including the AI analysis prompts for Google Gemini.
    -   **Summary of Changes**:
        -   The  endpoint was modified to return a new status, , when AI extraction fails predetermined criteria. Another status, , was added for cases where the ship's IMO number matches but the name differs.
        -   A new endpoint, , was created to handle the manual backfill process for older certificates.
        -   The AI prompt for  was updated to reflect user-requested changes in survey terminology.

-   ****
    -   **Summary**: This monolithic React file contains the entire frontend application, managing state, rendering all UI components (tables, modals, forms), and handling all API communication with the backend.
    -   **Summary of Changes**:
        -   The multi-upload progress bar logic was updated to handle the  status (showing a guidance message) and the  status (using a distinct color).
        -   The Add Certificate (manual input) and Edit Certificate forms were significantly refactored. They now include all database fields, use a compact multi-column grid layout, and have synchronized dropdown options for  and . The  field was made read-only. The  was converted into a dropdown with a custom date option.
        -   An Admin Tools section was added to the System Settings view, with state and functions () to trigger the backfill API and display its progress. A bug fix was applied to correctly retrieve the auth token for this API call.
        -   A Quick Edit feature was implemented for the Survey Type field in the certificate table. This involved adding state for a context menu (), creating event handlers (), and rendering the custom context menu. Debugging this feature required moving the menu's render location to fix a component scope issue and adding  to the  handler to prevent conflicts with a pre-existing row-level context menu.
</code_architecture>

<pending_tasks>
- There are no major pending features that were discussed and not implemented. The user explicitly requested to discard the Scheduled Job and Background Queue tasks. The current work is a minor text synchronization task.
</pending_tasks>

<current_work>
Immediately before this summary request, the task was to synchronize the display text for survey types across different UI components. The user pointed out an inconsistency: the new Quick Edit Survey Type context menu displays options like Special, while the existing Update Next Survey Type modal (part of the Edit Certificate form) displays Special Survey. The user requested that both places should display the shorter version (e.g., Special), removing the word Survey.

The AI engineer had correctly identified the two locations in  where these options are defined:
1.  The Quick Edit context menu rendering logic.
2.  The Survey Type dropdown options within the Edit Certificate modal form.

The work was paused just before modifying the code in  to make these text values consistent.
</current_work>

<optional_next_step>
I will proceed with editing  to remove the word Survey from the options in both the Quick Edit context menu and the Edit Certificate modal's Survey Type dropdown to ensure consistency as requested.
</optional_next_step>
