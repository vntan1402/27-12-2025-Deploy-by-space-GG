<analysis>
The previous AI engineer meticulously progressed through various stages of application development and stabilization. Initially, the focus was on setting up the environment, resolving dependency conflicts (Python and system-level OCR tools), and correcting critical configuration issues like the  for external access and MongoDB connection. Significant effort was dedicated to debugging and fixing core functionalities, including user login, AI-powered document analysis (especially for PDFs and images), and Google Drive integration, often caused by missing runtime dependencies or incorrect configuration logic. The engineer then moved to implementing complex UI/UX enhancements for the Certificate List table, such as column reordering, resizing, sorting, and adding interactive checkbox selection with a context menu. Throughout the trajectory, the AI engineer demonstrated strong debugging capabilities, systematically identifying root causes (e.g., missing OCR libraries causing AI fallback, incorrect Google Drive config for file viewing) and implementing targeted fixes. The codebase also underwent a substantial cleanup of unused files, streamlining the project.
</analysis>

<product_requirements>
The user manages a Ship Management System - With AI Support, a full-stack application (React, FastAPI, MongoDB) designed for maritime document management. Key requirements revolve around enhancing document processing, user experience, and overall system stability.
1.  **System Stabilization**: Resolve initial setup issues, ensure Preview URL access, and fix login functionality (missing admin user, Pydantic validation errors).
2.  **AI Analysis Improvement**: Enhance the Add New Ship and Multi Cert Upload workflows by implementing smart PDF type detection (text-based vs. image-based) to optimize processing (direct text extraction vs. OCR) and fix AI analysis fallbacks due to missing OCR dependencies (poppler-utils, tesseract-ocr). Support JPG/PNG uploads.
3.  **Google Drive Integration**: Ensure robust file viewing and management within Google Drive, resolving configuration mismatches between upload and view operations.
4.  **Certificate List UI/UX**:
    *   Reorder columns: Status between Next Survey and Notes; Issued by between Next Survey and Status.
    *   Enable column resizing (without visible icons, only cursor on hover).
    *   Implement column sorting (triangle icon for selected column).
    *   Rename Inspection Records to Hồ sơ Đăng kiểm (Class Survey Report) and Survey Reports to Báo cáo kiểm tra (Test Report) in Vietnamese.
    *   Certificates without a Valid Date should always display Valid status.
    *   Add checkbox selection for certificates (individual and select-all) with a right-click context menu (Open, Copy Link, Move, Delete).
    *   Implement delete confirmation for certificates.
5.  **Codebase Cleanup**: Remove unused files (old Apps Scripts, test files, documentation).
</product_requirements>

<key_technical_concepts>
-   **FastAPI**: Backend framework.
-   **React**: Frontend framework.
-   **MongoDB**: Database.
-   **OCR (Tesseract, Google Vision API)**: Optical Character Recognition for image-based documents.
-   **LLM Integration (Gemini)**: AI analysis for document data extraction.
-   **Google Drive API (via Apps Script)**: Document storage and management.
-   **Tailwind CSS**: Frontend styling.
-   **Supervisor**: Process control for services.
-   **Pydantic**: Data validation for API models.
-   **Poppler-utils, Tesseract-ocr**: System-level OCR dependencies.
</key_technical_concepts>

<code_architecture>
The application follows a standard full-stack architecture with a React frontend, FastAPI backend, and MongoDB for data persistence.



**Key Files and Changes:**

-   ****:
    -   **Importance**: Core backend logic, API endpoints for authentication, ship management, certificate upload, AI analysis, Google Drive integration.
    -   **Changes**:
        -   Added logic for environment variable usage ().
        -   Updated user creation, fixing Pydantic validation for  and .
        -   Implemented  for smart PDF classification.
        -   Modified  and  to use smart PDF/image processing.
        -   Updated  endpoint to support JPG/PNG and use smart processing.
        -   Fixed  to correctly use AI-extracted certificate names.
        -   Corrected Google Drive file viewing endpoint to prioritize .
        -   Added helper functions like .
-   ****:
    -   **Importance**: Centralizes OCR functionalities.
    -   **Changes**:
        -   Added  method to handle image files directly.
-   ****:
    -   **Importance**: Main React component managing application state, rendering UI, handling user interactions, and making API calls.
    -   **Changes**:
        -   Updated  for preview.
        -   Modified  attributes for file inputs to include JPG/PNG.
        -   Updated upload guidelines and translation constants for menu items.
        -   Implemented UI logic for Certificate List: column reordering (Status, Issued By), sorting, resizing (JavaScript event handlers, CSS classes), checkbox selection, and context menu actions (Open, Copy Link, Edit, Delete).
        -   Added state variables for selected certificates and modal visibility.
-   ****:
    -   **Importance**: Contains custom CSS for styling elements not covered by Tailwind, particularly for UI components like tables.
    -   **Changes**:
        -   Added styles for column resizing functionality (e.g., , ).
-   ****:
    -   **Importance**: Utility script for populating the database with an initial admin user.
    -   **Changes**:
        -   Updated to include  and  fields for  user.
        -   Added logic to delete existing users before creation to prevent duplicates during debugging.
-   ****:
    -   **Importance**: Lists all Python dependencies for the backend.
    -   **Changes**:
        -   Added , , , .
-   **System Dependencies**:
    -   ****: Required for PDF to image conversion (for OCR).
    -   ****: Required for text extraction from images by Tesseract.
</code_architecture>

<pending_tasks>
-   Implement the Move functionality within the Certificate List context menu. This requires creating a Folder Structure Modal for the user to select a destination folder and then moving the file on Google Drive.
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was working on enhancing the Certificate List table in the frontend. The last completed task involved adding interactive selection capabilities to the table:
1.  **Checkboxes**: Small checkboxes were added next to the No. column for each certificate.
2.  **Select/Deselect All**: A master checkbox in the table header allows users to select or deselect all currently displayed certificates.
3.  **Context Menu**: A right-click context menu was implemented for selected certificates, offering several options:
    *   Open: To view the certificate file.
    *   Copy Link: To copy the Google Drive link to the clipboard.
    *   Move: To move the certificate to a different folder.
    *   Edit: To edit certificate details.
    *   Delete: To remove the certificate from the system.
4.  **Delete Confirmation**: A confirmation modal is displayed when the Delete option is chosen, asking the user to confirm the deletion, especially for multiple certificates.

The core UI and state management for these features have been implemented in , including  state, , , , , , and the associated modals (). The Move functionality's UI () is prepared but its core logic (displaying folder structure and executing the move) is not yet implemented.
</current_work>

<optional_next_step>
Implement the Move functionality for selected certificates by developing a Folder Structure Modal.
</optional_next_step>
