<analysis>
The previous AI engineer has been meticulously working on the  V2 migration, tackling a series of functional and UI enhancements based on user feedback. The work began with refining backend deletion, migrating batch processing, and integrating V1 context menus. Subsequently, efforts focused on synchronizing ship filters, implementing the , and expanding its data display. The engineer addressed several bugs, including incorrect batch upload statuses, UI filter issues, API errors, and frontend function calls. The most recent task involves integrating and debugging the display of the  within the  page when no ship is selected, which encountered an issue with the panel not appearing.
</analysis>

<product_requirements>
The  application is migrating from V1 to V2 to enhance ship management with Google Drive integration and AI-assisted . Key features and fixes include:
1.  **V2  Page:** Mimics  with Crew List and Crew Certificates sub-categories and sidebar navigation.
2.  **Add Crew Modal:** AI-powered passport analysis, auto-fill, and refined UX.
3.  **Batch Processing:** V1 migration with  and  (Test Report style), smooth progress, and staggered file processing.
4.  **File Management:** Summary files upload to .
5.  **Deletion Functionality:** Frontend  and backend  with  for Google Drive file deletion;  added.
6.  **Context Menus:** V1 row context menu options (edit, bulk edit place/ship/date sign on/off) implemented using modals.
7.  **UI Synchronization:** Ship Selector and  filter are synchronized.  replaced by  (displaying company details like name, address, email, software expiry, logo) when All is selected.
8.  **Auto-Update Logic:**  auto-updates  to Standby and clears . Toast reminder for missing / on  update.
9.  **Standby Mode:**  hides Ship Sign On in Standby mode.
10. **CompanyInfoPanel Display:** Fetch and display company data correctly, including name, address, email, software expiry, logo, total ships, total crew. Layout to match  structure, with inline labels/values and an expiry notice if less than 30 days.
11. ** Integration:** Display  in  page when no ship is selected, above the Submenubar.
</product_requirements>

<key_technical_concepts>
-   **Frontend**: React.js (components, modals, state management, routing, context menus, , ), ,  (toast notifications), , .
-   **Backend**: FastAPI (API endpoints, , Pydantic models), MongoDB (UUIDs for IDs).
-   **Integrations**: Google Drive API (via Apps Script proxy and ), AI/LLM integration (Document AI, System AI).
-   **Patterns**: V2 analysis-first, background upload, modular component design, asynchronous deletion.
</key_technical_concepts>

<code_architecture>

-   ****:
    -   Importance: FastAPI application, defines all API endpoints.
    -   Changes:  DELETE endpoint refactored for . New  added.  implemented to fetch company details by ID; modified to return  (by counting ships in the  collection) and  (by counting crew in  collection) and map  to . Fixed 500 error due to incorrect MongoDB count method.
-   ****:
    -   Importance: Manages MongoDB interactions.
    -   Changes: Fixed issue with  method by ensuring  was used correctly.
-   ****:
    -   Importance: Manages Google Apps Script for Drive operations.
    -   Changes:  corrected for nested folder structures.
-   ****:
    -   Importance: Main page for Crew Records.
    -   Changes: Integrated , fetches  and . Dynamically shows  or . Fixed  error by passing it correctly as a prop to .
-   ****:
    -   Importance: Displays company information.
    -   Changes: Created to display company , , , , , , and . Styling and layout adjusted multiple times to match , reorganized into three columns with inline labels/values, and added expiry notice logic.
-   ****:
    -   Importance: Displays crew list, integrates modals, handles filters, sorting, search, and batch processing.
    -   Changes:  method call corrected. Bulk delete implemented. Batch processing logic updated for individual file progress, animation, stagger delay. V1 context menu options (bulk edit Place/Ship/Date Sign On/Off) integrated. Logic for  and  added with toast reminders. Auto-update logic for  implemented.  for synchronizing  filter. Fixed issue where batch upload in Standby mode incorrectly set status to Sign on. Implemented Standby option for crew status filter and fixed auto-refresh issues for all filters. Fixed table header sorting icons to display  (unsorted),  (ascending),  (descending).
-   ****:
    -   Importance: Modal for adding new crew.
    -   Changes: Success message for AI analysis displays when  and  are present. Ship Sign On field hidden in Standby mode. Added a Ship Select button next to Standby Crew in the header.
-   ****:
    -   Importance: Displays batch upload progress.
    -   Changes: Updated to match  style, with minimize button and individual file progress.
-   ****:
    -   Importance: Displays batch upload results.
    -   Changes: Updated to match  style, using a table format.
-   ****:
    -   Importance: Houses modals for bulk editing crew fields.
    -   Changes: Created for bulk editing Place Sign On, Ship Sign On, Date Sign On, and Date Sign Off.
-   ****:
    -   Importance: Frontend service for crew API calls.
    -   Changes: Added  method, corrected  method name to . Fixed export to ensure  is a callable function.
-   ****:
    -   Importance: Frontend service for company API calls.
    -   Changes: Imported  for potential re-export or direct use.
-   ****:
    -   Importance: Defines API routes.
    -   Changes:  and  corrected to .
-   ****:
    -   Importance: Main page for Class & Flag Certificates.
    -   Changes: Modified to display  when no ship is selected, similar to .
-   ****:
    -   Importance: Central export for components.
    -   Changes: Added  to the export list to make it available globally.
</code_architecture>

<pending_tasks>
-   Full testing of Sync from Drive functionality UI.
-   Bulk export/download for certificates via context menu.
-   Certificate File Viewer (embedded PDF viewer in modal, navigation, zoom, etc.).
-   Scalability improvements (load testing, Redis caching, query optimization, monitoring, sharding,  conversion, performance monitoring).
-   Implement toast notifications for Deleting files on Drive (start) and Successfully deleted X files (completion) for both  and , referring to .
-   Finish implementing the  component.
-   Implement the Crew Certificates sub-category page.
-   Verify the background file deletion for crew records after the backend changes are fully implemented and tested.
</pending_tasks>

<current_work>
Immediately prior to this summary, the AI engineer was addressing the user's feedback regarding the  not displaying correctly on the  page. The user reported that despite previous attempts to integrate it, the  was not visible when no ship was selected.

The AI engineer had already:
1.  Modified  to conditionally render  when  is null, similar to .
2.  Ensured  was being fetched and passed to  in .

However, the user's latest message (Chat 467) explicitly stated, CompanyInfoPanel chưa hiển thị (CompanyInfoPanel is not displayed), accompanied by a screenshot confirming its absence. The AI engineer is currently debugging this display issue, suspecting problems with component importing or exporting. Recent actions involved:
-   Checking  (Chat 469), then editing it (Chat 471) (though this file primarily handles API calls).
-   Searching for  in  (Chat 473).
-   Reading  (Chat 475) and subsequently editing it (Chat 478) to ensure  is correctly exported.
-   Finally, editing  (Chat 484) to verify correct import of .
</current_work>

<optional_next_step>
Verify if  now displays correctly in  when no ship is selected, given the recent import/export fixes.
</optional_next_step>
