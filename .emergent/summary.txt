<analysis>
The AI engineer's work involved an iterative development process to enhance the Ship Management System. Initially, the focus was on debugging Google Drive folder identification for Standby Crew files, leading to an understanding of the Apps Script's limitations and the backend's interaction. Subsequent work included implementing automatic file movement triggers for Standby status changes (creation, edit, bulk edit) and Ship Sign On assignments, requiring new backend endpoints and frontend logic. The Certificate Name field in the edit modal was upgraded to a searchable, customizable dropdown with  persistence. Significant effort went into refining file location logic, ensuring files move to correct Google Drive paths (root for ships, COMPANY DOCUMENT subfolder for Standby), and displaying actual file paths in tooltips. The ongoing task is to eliminate the hardcoded fallback for the Standby Crew folder ID.
</analysis>

<product_requirements>
The Ship Management System tracks crew records, certificates, and passports, supporting multi-file uploads, AI analysis, and expiration alerts. Issued By fields are normalized, and passports undergo validation. Core features include bypassing Certificate Holder Name Mismatch and integrating Date of Birth for validation with a Skip/Continue modal. UX improvements delivered include asynchronous file upload/delete feedback, auto-refresh of certificate lists, and a minimizable Add Crew Certificate modal. Bulk and single edit forms allow clearing date/place sign-on/off. Recent additions enable:
1. Automatic movement of original Passport/Crew Cert files for Standby crew to a designated Google Drive folder (triggered by status change, new crew, date sign-off input, or bulk date sign-off).
2. Certificate Name field as a searchable dropdown with custom input and persistence to .
3. Edit Ship Sign On option in the right-click context menu, with bulk editing, auto-setting status to Sign on, and clearing Date Sign Off.
4. Automatic movement of original files to  folder in the Company Drive root upon Ship Sign On (via edit or bulk edit).
5. Tooltips on file icons displaying the *actual* Google Drive folder path from the database.
</product_requirements>

<key_technical_concepts>
- **Full-stack Architecture**: React (frontend), FastAPI (backend), MongoDB (database).
- **Google Apps Script**: Middleware for Google Drive file operations (upload, move, delete, folder management).
- **Asynchronous Processing**: Non-blocking file operations for better UX.
- **Frontend State Management**: ,  in React for UI logic and local storage persistence.
- **API Integration**:  for frontend-backend communication,  for backend-Apps Script communication.
</key_technical_concepts>

<code_architecture>

-   ****
    -   **Summary:** Core FastAPI backend for API endpoints, AI, and database.
    -   **Changes:**
        -   Enhanced  validation and bypass.
        -    endpoint: Handles moving files for Standby Crew, updated to use enhanced folder finding logic (case-insensitive, whitespace-tolerant) within the  folder. Modified to store  in DB.
        -    (New): Handles moving files to  folder under the Company Drive root. Modified to store  in DB.
        -   Login endpoint corrected to use .
        -   Removed  filtering during  PUT updates to allow clearing fields.
-   ****
    -   **Summary:** Main React app, UI, state, interactions.
    -   **Changes:**
        -   Implemented  for DOB validation.
        -   Refactored  for async uploads.
        -   Added clickable icons for original/summary files.
        -   Enhanced  and  for feedback.
        -   Auto-refresh for Crew Certificates table on ship selection.
        -   Minimizable Add Crew Certificate modal.
        -   Updated  to allow clearing sign-on/off dates/places.
        -   **Automated File Movement:** Integrated  into  (if status changes to Standby) and  (if new crew status is Standby). Added logic to  of  field in Edit Crew Member to trigger auto-move. Integrated  into . Removed  call from Refresh button click.
        -   **Certificate Name Dropdown:** Modified Edit Crew Certificate modal to include a searchable dropdown for  with . Added  state and  to load/save custom names to , integrated  into .
        -   **Bulk Edit Ship Sign On:** Added  state,  to context menu,  logic (updates ship, sets status to Sign on, clears ). Created a new modal for this feature and added state to .
        -   **Ship-specific File Movement:** Integrated  helper function into  (on ship_sign_on change) and .
        -   **Actual File Location Tooltips:** Implemented  function that now retrieves  from the database. Updated tooltips for passport and certificate file icons.
-   ****
    -   **Summary:** Latest Google Apps Script for Drive operations.
    -   **Changes:** No direct edits in this trajectory. The backend calls this script for file operations. The  function's behavior (not dynamically finding Standby Crew within COMPANY DOCUMENT) was a key debug point.  function still only accepts .
-   ****
    -   **Summary:** Records testing outcomes, user problem statements, and communication.
    -   **Changes:** Continuously updated with new tasks, debugging steps, and testing results.
-   **New Documentation Files (.md):**
    -   
    -   
    -   
    -   
    -   
    -   
    -   These files document the implemented features, debug processes, and fixed issues.
-   **New Test Files (.py):**
    -   
    -   
    -   Created for debugging and testing the  endpoint.
</code_architecture>

<pending_tasks>
-   **Remove Hardcoded Standby Folder ID Fallback**: The backend currently falls back to a hardcoded Google Drive folder ID for Standby Crew if dynamic identification fails. This fallback needs to be removed.
</pending_tasks>

<current_work>
Immediately before this summary, the AI engineer was engaged in understanding the current logic for determining the Standby Crew folder ID in the backend (). The analysis confirmed that the backend first attempts to dynamically find or create the Standby Crew folder within COMPANY DOCUMENT (which was initially a point of confusion regarding the parent folder, but was corrected to  for Standby Crew and root for Ship folders), and if this process fails, it resorts to a hardcoded . The user's most recent explicit instruction was to remove this Fallback to hardcoded ID if all else fails mechanism.
</current_work>

<optional_next_step>
Remove the hardcoded fallback for the Standby Crew folder ID in .
</optional_next_step>
