<analysis>
The previous AI engineer diligently enhanced the  application, addressing numerous feature requests and critical bugs. Initial work fixed Delete Ship Google Drive issues and improved Add New Ship UX with a two-call pattern. The engineer resolved front-end issues like unclickable buttons and toast library conflicts, and backend freezes due to synchronous I/O by using .
Recent efforts focused on two main areas: implementing recalculation icons for ship survey dates and building out the comprehensive Certificate List functionality. The recalculation icons for Next Docking, Special Survey Cycle, and Anniversary Date were successfully integrated into , with backend APIs and frontend service methods confirmed. The Certificate List was extensively developed, including creating new components for the table, filters, action buttons, and various modals for adding, editing, deleting certificates, and handling duplicates/mismatches. AI auto-fill for certificates was fixed, and multi-certificate upload timeouts were resolved by sequential processing. The current focus is debugging an issue where an upcoming survey due within the specified window is not being displayed.
</analysis>

<product_requirements>
The overarching goal is to evolve  into a modular  with enhanced ship management. Key features include a secure Google Drive integration for DB backup/restore, UI improvements (dynamic logo, no sub-menu), and a streamlined Add New Ship flow with AI analysis, database-first creation, and background Google Drive folder provisioning. Ship display was refined ( over , Vietnamese labels). Edit Ship and Delete Ship modals were implemented, supporting DB-only or DB+Drive deletion. Recalculation icons for Next Docking, Special Survey Cycle, and Anniversary Date were added to trigger V1-based calculations. The Certificate List was developed to mirror V1's layout, functions, filters, and search, using V2's date handling. The Add Ship Certificate flow now includes AI auto-fill, duplicate/mismatch handling, sequential multi-upload, and auto-refresh. Edit/Delete Certificate functionalities are implemented, as are quick and bulk survey type updates. An Upcoming Survey Check modal displays certificates due within a ±3 month window, which is currently under debug.
</product_requirements>

<key_technical_concepts>
- **Frontend**: React.js, Context API, React Router, custom hooks, , .
- **Backend**: FastAPI, MongoDB (UUIDs, ISO strings), Pydantic, JWT auth, , .
- **Integrations**: Google Drive API (Apps Script proxy), API Key, Emergent LLM key.
- **Utilities**: Date helper functions.
</key_technical_concepts>

<code_architecture>

-   ****: FastAPI application. Confirmed/used API endpoints for ship calculation, certificate CRUD, multi-upload, upcoming surveys. Added  endpoint and debug logs for date.
-   ****: Main page for certificates. Heavily modified to integrate ship calculation icons, a comprehensive certificate list (table, filters, action buttons), and modals for Add/Edit/Delete Ship Certificates, Duplicate/Mismatch handling, and Upcoming Surveys. Manages all related states and handlers. Fixed syntax errors, implemented UI conditional rendering, and updated context menu handlers.
-   ****: Displays ship details. Modified to include clickable icons for Next Docking, Special Survey Cycle, Anniversary Date to trigger recalculations.
-   ****: New directory for certificate list components.
    -   ****: Displays certificate data, implemented V1-style sort icons.
    -   ****: UI for filtering certificates.
    -   ****: Action buttons for certificate management.
    -   ****: Modal for displaying upcoming surveys.
-   ****: New directory for ship certificate modals.
    -   ****: Form for adding certificates, with AI auto-fill, multi-upload (sequential to avoid timeouts), duplicate/mismatch detection. Fixed API endpoint and AI response field.
    -   ****: Form for editing certificates. Fixed API endpoint.
    -   ****: Confirmation for deleting certificates. Fixed API endpoint.
    -   ****: Modal for handling duplicate certificates.
    -   ****: Modal for handling ship name mismatches.
-   ****: Contains methods for ship calculations.
-   ****: Handles ship certificate API calls.
-   ****: Defines API endpoints, including new calculation and certificate routes.
-   ****: Utility functions for date handling.
-   ****: Document explaining certificate abbreviation logic.
-   ****: Document explaining upcoming survey window logic.
</code_architecture>

<pending_tasks>
- The Sync from Drive (restore database) functionality UI integration and full testing in the frontend are still pending.
- Debug the Upcoming Survey Check logic: Investigate why a survey due on 28/11/2025 is not showing as upcoming when the server date is 30/10/2025, despite falling within the ±3 month window.
</pending_tasks>

<current_work>
Immediately before this summary, the AI engineer was debugging the Upcoming Survey Check feature. The user reported that a survey due on 28/11/2025 was not appearing as upcoming in the , even when the current server date was identified as 30/10/2025. This is unexpected as 28/11/2025 falls within the backend's ±3 month window from 30/10/2025 (less than 1 month away).

Prior work in this area involved:
1.  **Backend Logic Analysis**: Verified 's  endpoint logic, which applies a ±3 month window around the  date.
2.  **Debugging Tools**: Added a new API endpoint  in  and a corresponding frontend component to accurately retrieve and display the server's current date/time to isolate potential timezone or date-value issues.
3.  **Documentation**: Created  to explain the 3-month window design choice.

The current stage is to investigate the discrepancy between the expected and observed behavior of the upcoming survey display, focusing on checking backend logs and the actual certificate data.
</current_work>

<optional_next_step>
Check backend logs and certificate data to diagnose why the 28/11/2025 survey is not displayed as upcoming.
</optional_next_step>
