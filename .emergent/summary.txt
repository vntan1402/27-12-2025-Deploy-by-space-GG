<analysis>
The AI engineer's work primarily involved enhancing the Ship Management System's certificate, crew, and file management features. This trajectory details numerous iterative development and debugging cycles. Key tasks included implementing Date of Birth (DOB) extraction via AI, developing frontend and backend validation for DOB mismatches with a Skip/Continue modal, and refining the user experience for file uploads and deletions (making them asynchronous). Significant effort was dedicated to improving the process of moving crew documents to a Standby Crew folder in Google Drive, which uncovered challenges with Apps Script's folder identification logic. Additionally, the engineer addressed several UI/UX issues, such as auto-refreshing lists, enabling modal minimization, and allowing null values for date and place fields in bulk and single edits. The current outstanding issue revolves around the Apps Script's inability to dynamically locate the existing Standby Crew folder.
</analysis>

<product_requirements>
The Ship Management System facilitates comprehensive tracking of crew records, certificates, and passports. It supports multi-file, staggered parallel uploads with integrated AI analysis, duplicate checks, and highlights critical expiring certificates. Issued By fields are normalized and abbreviated. Passports undergo validation and are uploaded post-database entry, with all files consistently stored in Google Drive. Recent enhancements include preventing crew deletion if associated certificates exist and ensuring AI-extracted  matches the crew member's name. The UI now features improved search/filters and ship auto-selection. Critical new features allow bypassing Certificate Holder Name Mismatch validation and integrate a Date of Birth field into crew certificates. This DOB field pre-fills from crew data, is persisted in the database, and uses AI extraction for validation (only when crew data includes DOB), with a Skip/Continue modal for mismatches. Further UX improvements include asynchronous file upload/delete feedback, auto-refresh of certificate lists upon ship selection, a minimizable Add Crew Certificate modal, and automated movement of original Passport/Crew Cert files for Standby crew to a designated Google Drive folder. Bulk and single edit forms now permit clearing Date Sign Off, Date Sign On, and Place Sign On by submitting empty values.
</product_requirements>

<key_technical_concepts>
-   **Full-stack Architecture**: React (frontend), FastAPI (backend), MongoDB (database).
-   **AI Integration**: Google Document AI for data extraction, custom prompt engineering (Gemini/GPT).
-   **Google Apps Script**: Intermediary for Google Drive file operations (upload, move, delete).
-   **Data Normalization**: Standardizing Issued By fields and crew names (Vietnamese diacritics).
-   **Asynchronous Processing**: Non-blocking file uploads and deletions.
-   **Pydantic**: Data validation and serialization in FastAPI.
</key_technical_concepts>

<code_architecture>

-   ****
    -   **Summary:** FastAPI backend, managing API endpoints, AI integration, and database operations.
    -   **Changes:** Extended AI prompt for  extraction. Added  validation logic (compared AI-extracted vs. crew DOB), with  parameter. Fixed a bug where  was caught by a generic . Introduced  endpoint to handle moving original passport/certificate files to a Standby Crew folder, initially attempting dynamic folder ID lookup then falling back to a hardcoded ID. Refined file moving logic to only process original files. Corrected a critical issue where  values were filtered out during  PUT updates, preventing fields like  from being cleared in the database. Updated MongoDB queries to use  helper.
-   ****
    -   **Summary:** Main React application, handling UI, state, and user interactions.
    -   **Changes:** Implemented  state and associated handlers (, ) for date of birth mismatch. Refactored  for asynchronous file uploads, allowing modal closure and list refresh immediately after record creation, with separate toasts for upload status. Added clickable icons for original and summary files in the Crew Cert Name column and for Passport files, linking to their respective URLs. Enhanced  and  to provide better loading feedback and ensure list refresh. Implemented auto-refresh for the Crew Certificates table when a different ship is selected, by simulating a click on the refresh button. Added  state, minimize button, and a floating indicator for the Add Crew Certificate modal. Updated  to call the new backend  endpoint. Removed disabled conditions and updated messages in Bulk Edit Date Sign Off, Bulk Edit Date Sign On, and Bulk Edit Place Sign On modals to allow clearing values. Modified  to ensure clearing  (and , ) fields in the Edit Crew Member modal functions correctly.
-   ****
    -   **Summary**: Handles communication with Google Apps Script for file operations.
    -   **Changes**:  updated to prioritize  for Google Apps Script URL. No new changes in this trajectory segment.
-   ****
    -   **Summary**: This is the latest Google Apps Script provided by the user, handling file uploads, moves, renames, deletes, and folder structure management.
    -   **Changes**: No direct edits were made to this file in the trajectory. However, the backend's  calls this script, and its behavior (specifically  not detecting Standby Crew dynamically) is a current point of contention.
-   **** (New File)
    -   **Summary**: A new Apps Script file proposed to support moving files using a  instead of just .
    -   **Changes**: Created, but not fully integrated or confirmed as the final solution due to user feedback.
-   ****
    -   **Summary**: Records testing outcomes, user problem statements, and communication with testing agents.
    -   **Changes**: Continuously updated to reflect new tasks, debugging steps, and testing results throughout the development process.
-   **** (New File)
    -   **Summary**: Documentation detailing the multi-file upload process for crew certificates.
    -   **Changes**: Created to explain the step-by-step procedure of file uploads.
</code_architecture>

<pending_tasks>
-   **Debug Apps Script Folder Identification**: The  is failing to dynamically identify the Standby Crew folder, forcing the backend to use a hardcoded folder ID. This needs to be resolved to allow dynamic folder location/creation.
</pending_tasks>

<current_work>
Immediately before this summary, the AI engineer was debugging the automatic movement of Standby crew files (Passport and Crew Certificates) to a dedicated Standby Crew folder in Google Drive. While files were successfully moved using a hardcoded folder ID for Standby Crew, the backend's logic for *dynamically finding or creating* this folder via the Google Apps Script was failing. Backend logs indicated that the Apps Script's  function was not locating the existing Standby Crew folder, leading to a fallback mechanism. The last message from the AI engineer confirms that the Apps Script's  function is failing to list the existing Standby Crew folder, despite it being present in Google Drive.
</current_work>

<optional_next_step>
Debug the  function in the Apps Script to ensure it can correctly identify existing folders, specifically the Standby Crew folder.
</optional_next_step>
