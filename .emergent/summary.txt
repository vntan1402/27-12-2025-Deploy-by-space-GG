<analysis>
The AI engineer's work during this trajectory predominantly focused on the  module, specifically enhancing  functionalities. Initial efforts involved resolving an issue where the  state wasn't propagated to the  component, and implementing batch Google Drive link retrieval. Subsequent critical tasks included fixing a  scoping error in the backend's  endpoint and iteratively refining the  and  calculation and display logic based on continuous user feedback. The engineer also addressed UI/UX improvements by updating dropdown options in modals and standardizing the status display in tables, while also implementing bulk file operations. The trajectory highlights an iterative, feedback-driven development process with frequent debugging.
</analysis>

<product_requirements>
The primary goal is to enhance the  module for , building upon existing AI-powered analysis and Google Drive integration. Recent explicit requests involved:
1.  Ensure  state is passed to .
2.  Implement Batch get Drive links with progress for Audit Certificates.
3.  Correct the display of Next Survey for Interim certificates (show Valid Date (-3M) instead of calculated date).
4.  Correct the display of Next Survey for Full Term certificates without Last Endorse (show calculated date (-2 years) with (±3M) annotation).
5.  Modify the Next Survey Type dropdown list in Add/Edit modals to remove Annual, Special, and add Initial, while keeping Intermediate, Renewal.
6.  Resolve issues with Safety Management Certificate abbreviation displaying as SM instead of SMC.
7.  Redefine the  logic with specific window definitions, overdue, due soon, and critical conditions for Initial, Renewal, and Intermediate types.
8.  Update the display message for upcoming surveys from cần khảo sát trong 30 ngày tới to cần đánh giá trong những ngày tới.
9.  Standardize the  UI to match 's table format.
10. Implement bulk operations (copy link, view, download) for Audit Certificates, mirroring Ship Certificate functionality.
11. Clarify and adjust the display logic for the Status column, specifically changing Over Due to Due Soon and comparing against window_close instead of Valid Date.
</product_requirements>

<key_technical_concepts>
-   **Frontend**: React.js (state, hooks, components, modals),  for API calls, Tailwind CSS.
-   **Backend**: FastAPI (API endpoints, ), MongoDB (UUIDs), date/time manipulation (, ).
-   **Patterns**: Modular design, iterative development, UI/UX consistency, error handling, background processing.
</key_technical_concepts>

<code_architecture>

-   ****: FastAPI application.
    -   **Importance**: Central API for all backend operations.
    -   **Changes**:
        -   Fixed  scoping issue in .
        -   Updated  to adjust Next Survey display logic for Interim (Valid Date -3M) and Full Term (calculated date ±3M) certificates.
        -   Added  API endpoint and fixed previous conflicts.
        -   Completely refactored  endpoint with new logic based on  window and status (Due Soon, Critical, Overdue).
        -   Corrected endpoint order to resolve 404 for .
        -   Fixed  error for .
-   ****: Main page for ISM-ISPS-MLC module.
    -   **Importance**: Renders Audit Certificates, manages state, and integrates components.
    -   **Changes**:
        -    state passed to  (already present, verified).
        -   Added  and  states for batch link retrieval.
        -   Implemented  function for batch link fetching, using  to trigger it.
        -   Passed new  and  props to .
        -   Fixed API call in  to use .
        -   Implemented , ,  functions.
        -   Updated the certificate context menu to include bulk actions.
-   ****: Modal for adding audit certificates.
    -   **Importance**: UI for certificate uploads and data entry.
    -   **Changes**: Updated Next Survey Type dropdown to remove Annual, Special and add Initial.
-   ****: Modal for editing audit certificates.
    -   **Importance**: UI for modifying existing certificate data.
    -   **Changes**: Updated Next Survey Type dropdown to remove Annual, Special and add Initial.
-   ****: Action buttons for audit certificates.
    -   **Importance**: Provides various actions like add, delete, update.
    -   **Changes**: Verified to correctly receive and use  (already present).
-   ****: Frontend service for Audit Certificate API calls.
    -   **Importance**: Abstracts API interactions.
    -   **Changes**: Added  function to call the backend endpoint.
-   ****: Modal displaying upcoming audit surveys.
    -   **Importance**: Presents summarized upcoming survey information.
    -   **Changes**:
        -   Updated message cần khảo sát trong 30 ngày tới to cần đánh giá trong những ngày tới.
        -   Refactored UI to match  (table format, color-coded badges, row highlighting).
-   ****: Table displaying audit certificates.
    -   **Importance**: Renders the list of audit certificates.
    -   **Changes**: Changed status text from Over Due to Due Soon. Modified status calculation to compare against  instead of .
-   ****: Table displaying ship certificates.
    -   **Importance**: Renders the list of ship certificates.
    -   **Changes**: Changed status text from Over Due to Due Soon. Modified status calculation to compare against  instead of .
-   ****: Modal displaying upcoming ship surveys.
    -   **Importance**: Reference for  UI. No direct changes in trajectory.
</code_architecture>

<pending_tasks>
-   Full testing of Sync from Drive functionality UI.
-   Bulk export/download for certificates via context menu (partially done: bulk view/download/copy links are implemented, but export is not explicitly confirmed).
-   Certificate File Viewer (embedded PDF viewer in modal, navigation, zoom, etc.).
-   Scalability improvements (load testing, Redis caching, query optimization, monitoring, sharding,  conversion, performance monitoring).
-   Implement toast notifications for Deleting files on Drive (start) and Successfully deleted X files (completion) for both  and .
-   Finish implementing the  component (for Crew Records).
-   Verify the background file deletion for crew records.
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was working on refining the display logic for certificate statuses. The user requested to change the status comparison in the  and  from comparing against  to comparing against .

Specifically:
-   **Backend:** The  function and the  endpoint have been updated multiple times to correctly calculate and display  dates based on certificate type (Interim, Full Term) and last endorse dates. The  endpoint logic has also been heavily revised based on user requirements.
-   **Frontend:** The  and  components'  function has been modified.
    -   Previously, it compared  with .
    -   The user requested to compare  with , which is derived from the  annotations (e.g., ±3M, -3M).
    -   The AI engineer has already implemented this change in both  and .
    -   The latest action was to restart the frontend after applying this change to .

The current state is that the  function in both certificate tables has been updated to use  for status comparison.
</current_work>

<optional_next_step>
Continue checking the logic of Ship Certificate Upcoming Survey as requested by the user: Kiểm tra lại đoạnc code tính Upcoming Survey cho Ship Certificate.
</optional_next_step>
