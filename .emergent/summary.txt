<analysis>
The AI engineer's work during this trajectory predominantly focused on the  module. Initial efforts involved resolving  state propagation, batch Google Drive link retrieval, and backend  scoping errors. A significant phase harmonized  logic for both Ship and Audit Certificates, adopting a simpler, annotation-based approach, along with UI standardization and default annotation fallback. Subsequently, the  functionality was fully migrated to an  module, involving extensive creation of frontend components, services, and backend API endpoints. This migration required thorough refactoring of the new  component to use parent props, resolving numerous compilation and linting errors, and meticulous review of labels and file paths for internationalization. The trajectory concluded with debugging issues related to AI configuration for the new  analysis, identifying discrepancies in AI config lookup methods and an empty database for AI settings.
</analysis>

<product_requirements>
The primary goal is to enhance the  module for  and introduce . Key requests included:
1.  Harmonize  calculation and display logic for Ship and Audit Certificates, adopting the Audit Certificate's annotation-based approach.
2.  Implement a fallback for  calculation to auto-use  if no annotation exists for both Ship and Audit Certificates.
3.  Format  dates in modals to .
4.  Migrate the entire  functionality, including UI, services, and backend, to a new  module within .
5.  Refactor the new  component for modularity and prop-based data handling.
6.  Review and correct all labels, I18n strings, and file paths for the  module.
7.  Investigate and resolve issues with AI configuration and analysis for the  feature, including rechecking the AI setup method in  as a reference.
</product_requirements>

<key_technical_concepts>
-   **Frontend**: React.js (state, hooks, components, modals),  for API calls, Tailwind CSS for styling, Internationalization (I18n).
-   **Backend**: FastAPI (API endpoints, ), MongoDB (UUIDs, schema for Audit Reports),  manipulation.
-   **Patterns**: Modular component design, iterative development, UI/UX consistency, error handling, background processing, API service abstraction.
-   **External**: Google Drive integration (for file links), Emergent LLM Key (for AI analysis).
</key_technical_concepts>

<code_architecture>

-   ****:
    -   **Importance**: Handles all backend API logic.
    -   **Changes**:
        -   Refactored  endpoint to use a simpler, annotation-based logic similar to Audit Certificates.
        -   Implemented fallback logic for upcoming survey calculation to default to  if no annotation for both Ship and Audit Certificates.
        -   Added new Pydantic models (, , ) and 6 API endpoints ( for CRUD and analyze functionality).
        -   Improved error handling for  endpoint.
-   ****:
    -   **Importance**: Main page for , now integrating  functionality.
    -   **Changes**: Imported  components and service. Added state, handlers, and replaced the  placeholder with  and its associated modals.
-   ****:
    -   **Importance**: Displays upcoming ship surveys.
    -   **Changes**: UI updated to match  styling, now uses  for date formatting.
-   ****:
    -   **Importance**: Displays upcoming audit surveys.
    -   **Changes**: Now uses  for  to ensure  format.
-   ** (NEW directory)**: Contains the new components for .
    -   ****: Copied from  and refactored to be a pure component, receiving data and callbacks via props. Resolved multiple compilation errors, duplicate declarations, and updated labels/file paths for  context.
    -   ****, ****, ****: New modals adapted from  counterparts.
    -   ****: Exports all  components.
-   ** (NEW file)**:
    -   **Importance**: Frontend service for  API interactions.
    -   **Changes**: Provides functions for CRUD operations and AI analysis for audit reports.
-   ****:
    -   **Importance**: Central export for all frontend services.
    -   **Changes**: Added export for .
-   ****:
    -   **Importance**: Provides utility functions for date manipulation and formatting.
    -   **Changes**: Confirmed existence of  for  formatting.
</code_architecture>

<pending_tasks>
-   Full testing of Sync from Drive functionality UI.
-   Bulk export/download for certificates via context menu.
-   Certificate File Viewer.
-   Scalability improvements.
-   Toast notifications for Deleting files on Drive for  and .
-   Finish implementing the  component (for Crew Records).
-   Verify background file deletion for crew records.
-   Comprehensive testing of the newly migrated  module (Phase 11).
-   Address AI configuration for , resolve lookup discrepancies, and set up a default AI config.
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was investigating an issue where  analysis () was failing with 403/400 errors. The core problem is that AI configuration data is missing in the database for the current company/ship. The AI engineer has identified a discrepancy in AI config lookup: older modules (like ) use  with the  collection, while the new  module's analyze endpoint seems to expect configuration tied to  and potentially interacts with an  collection. All attempts to query existing ship or AI config data from the database returned empty results, suggesting a data persistence or environment setup issue. The AI engineer has already retrieved the . The current task is to Kiểm tra lại cách cài đặt AI trong Survey report (Recheck AI setup method in Survey report) to understand a working configuration as a reference for fixing the  AI analysis.
</current_work>

<optional_next_step>
Recheck the AI setup method for  to understand its working configuration.
</optional_next_step>
